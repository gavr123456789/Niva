type ArgParser 
type ArgsParsed 
  path: String? 
  option: CompilerOption
  // flags
  verbose: Bool
  lsp: Bool

constructor ArgsParsed help = ArgsParsed path: null option: CompilerOption.Help verbose: false lsp: false

/// prints help if its explicit
/// if there a mistake in args, returns Help flag
constructor ArgParser args::List::String -> ArgsParsed = [
  help = """
    Usage:
      run — compile and run project from main.niva (recursive)
      run FILE — compile and run project from root file (recursive)
      build FILE — compile only the given file
  """ trimIndent

  args contains: "--help", ifTrue: [
    ^ ArgsParsed help
  ]

  // separate flags from args
  // flags = #{"--verbose" false 
  //           "--lsp"     false}

  mut verbose = false
  mut lsp = false
  filteredArgs = args filter: [
    // flags at: it put: true
    it == "--verbose" ifTrue: [verbose <- true]
    it == "--lsp" ifTrue: [lsp <- true]
    (verbose || lsp) not
  ]

  getFirstArg = [
    arg = args at: 0
    | arg
    | "run" => CompilerOption.Run
    | "build" => CompilerOption.Build
    | "info" => CompilerOption.Info
    |=> [
      "$arg arg is unknown" echo
      CompilerOption.Help
    ]
  ]

  ^ | args count
    | 1 => [
      arg0 = args at: 0
      | arg0
      | "run" => ArgsParsed path: null option: CompilerOption.Run verbose: verbose lsp: lsp
      | "build" => ArgsParsed help
      | "info" => ArgsParsed path: null option: CompilerOption.Info verbose: verbose lsp: lsp
      |=> ArgsParsed help
    ]
    | 2 => [
      arg1 = getFirstArg do
      arg2 = args at: 1
      ArgsParsed path: arg2 option: arg1 verbose: verbose lsp: lsp
    ]
    |=> ArgsParsed help
]

enum CompilerOption = Run | Build | Daemon | RunTests | Info | Help
